(function(d){var f=this.SelectBox=function(a,c){if(a instanceof jQuery)if(0<a.length)a=a[0];else return;this.typeTimer=null;this.typeSearch="";this.isMac=navigator.platform.match(/mac/i);select_options=c="object"===typeof c?c:{};this.selectElement=a;if(!c.mobile&&navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i)||"select"!==a.tagName.toLowerCase())return!1;this.init(c)};f.prototype.version="1.2.0";f.prototype.init=function(a){var c=d(this.selectElement);if(c.data("selectBox-control"))return!1;
var b=d('<a class="selectBox" />'),e=c.attr("multiple")||1<parseInt(c.attr("size")),g=a||{},h=parseInt(c.prop("tabindex"))||0,l=this;b.addClass(c.attr("class")).attr("title",c.attr("title")||"").attr("tabindex",h).css("display","inline-block").bind("focus.selectBox",function(){this!==document.activeElement&&document.body!==document.activeElement&&d(document.activeElement).blur();b.hasClass("selectBox-active")||(b.addClass("selectBox-active"),c.trigger("focus"))}).bind("blur.selectBox",function(){b.hasClass("selectBox-active")&&
(b.removeClass("selectBox-active"),c.trigger("blur"))});!1==select_options.autoWidth&&b.width(c.outerWidth());!0==select_options.autoWidth&&b.css("display","block");d(window).data("selectBox-bindings")||d(window).data("selectBox-bindings",!0).bind("scroll.selectBox",g.hideOnWindowScroll?this.hideMenus:d.noop).bind("resize.selectBox",this.hideMenus);c.attr("disabled")&&b.addClass("selectBox-disabled");c.bind("click.selectBox",function(a){b.focus();a.preventDefault()});if(e){if(a=this.getOptions("inline"),
b.append(a).data("selectBox-options",a).addClass("selectBox-inline selectBox-menuShowing").bind("keydown.selectBox",function(a){l.handleKeyDown(a)}).bind("keypress.selectBox",function(a){l.handleKeyPress(a)}).bind("mousedown.selectBox",function(a){1===a.which&&(d(a.target).is("A.selectBox-inline")&&a.preventDefault(),b.hasClass("selectBox-focus")||b.focus())}).insertAfter(c),!c[0].style.height){e=c.attr("size")?parseInt(c.attr("size")):5;h=b.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");
h.find(".selectBox-options").html("<li><a>\u00a0</a></li>");var f=parseInt(h.find(".selectBox-options A:first").html("&nbsp;").outerHeight());h.remove();b.height(f*e)}}else e=d('<span class="selectBox-label" />'),h=d('<span class="selectBox-arrow" />'),e.attr("class",this.getLabelClass()).text(this.getLabelText()),a=this.getOptions("dropdown"),a.appendTo("BODY"),b.data("selectBox-options",a).addClass("selectBox-dropdown").append(e).append(h).bind("mousedown.selectBox",function(c){1===c.which&&(b.hasClass("selectBox-menuShowing")?
l.hideMenus():(c.stopPropagation(),a.data("selectBox-down-at-x",c.screenX).data("selectBox-down-at-y",c.screenY),l.showMenu()))}).bind("keydown.selectBox",function(a){l.handleKeyDown(a)}).bind("keypress.selectBox",function(a){l.handleKeyPress(a)}).bind("open.selectBox",function(a,b){b&&!0===b._selectBox||l.showMenu()}).bind("close.selectBox",function(a,b){b&&!0===b._selectBox||l.hideMenus()}).insertAfter(c),!1==select_options.autoWidth&&(h=b.width()-h.outerWidth()-(parseInt(e.css("paddingLeft"))||
0)-(parseInt(e.css("paddingRight"))||0),e.width(h));this.disableSelection(b);c.addClass("selectBox").data("selectBox-control",b).data("selectBox-settings",g).hide()};f.prototype.getOptions=function(a){var c,b=d(this.selectElement),e=this,g=function(a,b){a.children("OPTION, OPTGROUP").each(function(){if(d(this).is("OPTION"))0<d(this).length?e.generateOptions(d(this),b):b.append("<li>\u00a0</li>");else{var a=d('<li class="selectBox-optgroup" />');a.text(d(this).attr("label"));b.append(a);b=g(d(this),
b)}});return b};switch(a){case "inline":return c=d('<ul class="selectBox-options" />'),c=g(b,c),c.find("A").bind("mouseover.selectBox",function(a){e.addHover(d(this).parent())}).bind("mouseout.selectBox",function(a){e.removeHover(d(this).parent())}).bind("mousedown.selectBox",function(a){1===a.which&&(a.preventDefault(),b.selectBox("control").hasClass("selectBox-active")||b.selectBox("control").focus())}).bind("mouseup.selectBox",function(a){1===a.which&&(e.hideMenus(),e.selectOption(d(this).parent(),
a))}),this.disableSelection(c),c;case "dropdown":c=d('<ul class="selectBox-dropdown-menu selectBox-options" />');c=g(b,c);c.data("selectBox-select",b).css("display","none").appendTo("BODY").find("A").bind("mousedown.selectBox",function(a){1===a.which&&(a.preventDefault(),a.screenX===c.data("selectBox-down-at-x")&&a.screenY===c.data("selectBox-down-at-y")&&(c.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),/android/i.test(navigator.userAgent.toLowerCase())&&/chrome/i.test(navigator.userAgent.toLowerCase())&&
e.selectOption(d(this).parent()),e.hideMenus()))}).bind("mouseup.selectBox",function(a){1!==a.which||a.screenX===c.data("selectBox-down-at-x")&&a.screenY===c.data("selectBox-down-at-y")||(c.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),e.selectOption(d(this).parent()),e.hideMenus())}).bind("mouseover.selectBox",function(a){e.addHover(d(this).parent())}).bind("mouseout.selectBox",function(a){e.removeHover(d(this).parent())});a=b.attr("class")||"";if(""!==a){a=a.split(" ");for(var h=
0;h<a.length;h++)c.addClass(a[h]+"-selectBox-dropdown-menu")}this.disableSelection(c);return c}};f.prototype.getLabelClass=function(){return("selectBox-label "+(d(this.selectElement).find("OPTION:selected").attr("class")||"")).replace(/\s+$/,"")};f.prototype.getLabelText=function(){return d(this.selectElement).find("OPTION:selected").text()||"\u00a0"};f.prototype.setLabel=function(){var a=d(this.selectElement).data("selectBox-control");a&&a.find(".selectBox-label").attr("class",this.getLabelClass()).text(this.getLabelText())};
f.prototype.destroy=function(){var a=d(this.selectElement),c=a.data("selectBox-control");c&&(c.data("selectBox-options").remove(),c.remove(),a.removeClass("selectBox").removeData("selectBox-control").data("selectBox-control",null).removeData("selectBox-settings").data("selectBox-settings",null).show())};f.prototype.refresh=function(){var a=d(this.selectElement).data("selectBox-control"),c=a.hasClass("selectBox-dropdown")?"dropdown":"inline",b;a.data("selectBox-options").remove();b=this.getOptions(c);
a.data("selectBox-options",b);switch(c){case "inline":a.append(b);break;case "dropdown":this.setLabel(),d("BODY").append(b)}"dropdown"===c&&a.hasClass("selectBox-menuShowing")&&this.showMenu()};f.prototype.showMenu=function(){var a=this,c=d(this.selectElement),b=c.data("selectBox-control"),e=c.data("selectBox-settings"),g=b.data("selectBox-options");if(b.hasClass("selectBox-disabled"))return!1;this.hideMenus();var h=parseInt(b.css("borderBottomWidth"))||0,f=parseInt(b.css("borderTopWidth"))||0,p=
b.offset(),s=e.topPositionCorrelation?e.topPositionCorrelation:0,t=e.bottomPositionCorrelation?e.bottomPositionCorrelation:0,u=g.outerHeight(),r=b.outerHeight(),k=parseInt(g.css("max-height")),m=d(window).scrollTop(),n=p.top-m,q=d(window).height()-(n+r),h=(m=n>q&&(null==e.keepInViewport?!0:e.keepInViewport))?p.top-u+f+s:p.top+r-h-t;n<k&&q<k&&(m?(f=k-(n-5),g.css({"max-height":k-f+"px"}),h+=f):g.css({"max-height":k-(k-(q-5))+"px"}));g.data("posTop",m);g.width(b.innerWidth()).css({top:h,left:b.offset().left}).addClass("selectBox-options selectBox-options-"+
(m?"top":"bottom"));if(c.triggerHandler("beforeopen"))return!1;k=function(){c.triggerHandler("open",{_selectBox:!0})};switch(e.menuTransition){case "fade":g.fadeIn(e.menuSpeed,k);break;case "slide":g.slideDown(e.menuSpeed,k);break;default:g.show(e.menuSpeed,k)}e.menuSpeed||k();e=g.find(".selectBox-selected:first");this.keepOptionInView(e,!0);this.addHover(e);b.addClass("selectBox-menuShowing selectBox-menuShowing-"+(m?"top":"bottom"));d(document).bind("mousedown.selectBox",function(b){1!==b.which||
d(b.target).parents().andSelf().hasClass("selectBox-options")||a.hideMenus()})};f.prototype.hideMenus=function(){0!==d(".selectBox-dropdown-menu:visible").length&&(d(document).unbind("mousedown.selectBox"),d(".selectBox-dropdown-menu").each(function(){var a=d(this),c=a.data("selectBox-select"),b=c.data("selectBox-control"),e=c.data("selectBox-settings"),g=a.data("posTop");if(c.triggerHandler("beforeclose"))return!1;var h=function(){c.triggerHandler("close",{_selectBox:!0})};if(e){switch(e.menuTransition){case "fade":a.fadeOut(e.menuSpeed,
h);break;case "slide":a.slideUp(e.menuSpeed,h);break;default:a.hide(e.menuSpeed,h)}e.menuSpeed||h();b.removeClass("selectBox-menuShowing selectBox-menuShowing-"+(g?"top":"bottom"))}else d(this).hide(),d(this).triggerHandler("close",{_selectBox:!0}),d(this).removeClass("selectBox-menuShowing selectBox-menuShowing-"+(g?"top":"bottom"));a.css("max-height","");a.removeClass("selectBox-options-"+(g?"top":"bottom"));a.data("posTop",!1)}))};f.prototype.selectOption=function(a,c){var b=d(this.selectElement);
a=d(a);var e=b.data("selectBox-control");b.data("selectBox-settings");if(e.hasClass("selectBox-disabled")||0===a.length||a.hasClass("selectBox-disabled"))return!1;if(b.attr("multiple"))if(c.shiftKey&&e.data("selectBox-last-selected")){a.toggleClass("selectBox-selected");var g;g=a.index()>e.data("selectBox-last-selected").index()?a.siblings().slice(e.data("selectBox-last-selected").index(),a.index()):a.siblings().slice(a.index(),e.data("selectBox-last-selected").index());g=g.not(".selectBox-optgroup, .selectBox-disabled");
a.hasClass("selectBox-selected")?g.addClass("selectBox-selected"):g.removeClass("selectBox-selected")}else this.isMac&&c.metaKey||!this.isMac&&c.ctrlKey?a.toggleClass("selectBox-selected"):(a.siblings().removeClass("selectBox-selected"),a.addClass("selectBox-selected"));else a.siblings().removeClass("selectBox-selected"),a.addClass("selectBox-selected");e.hasClass("selectBox-dropdown")&&e.find(".selectBox-label").text(a.text());var h=0,f=[];b.attr("multiple")?e.find(".selectBox-selected A").each(function(){f[h++]=
d(this).attr("rel")}):f=a.find("A").attr("rel");e.data("selectBox-last-selected",a);b.val()!==f&&(b.val(f),this.setLabel(),b.trigger("change"));return!0};f.prototype.addHover=function(a){a=d(a);d(this.selectElement).data("selectBox-control").data("selectBox-options").find(".selectBox-hover").removeClass("selectBox-hover");a.addClass("selectBox-hover")};f.prototype.getSelectElement=function(){return this.selectElement};f.prototype.removeHover=function(a){d(a);d(this.selectElement).data("selectBox-control").data("selectBox-options").find(".selectBox-hover").removeClass("selectBox-hover")};
f.prototype.keepOptionInView=function(a,c){if(a&&0!==a.length){var b=d(this.selectElement).data("selectBox-control"),e=b.data("selectBox-options"),b=b.hasClass("selectBox-dropdown")?e:e.parent(),e=parseInt(a.offset().top-b.position().top),g=parseInt(e+a.outerHeight());c?b.scrollTop(a.offset().top-b.offset().top+b.scrollTop()-b.height()/2):(0>e&&b.scrollTop(a.offset().top-b.offset().top+b.scrollTop()),g>b.height()&&b.scrollTop(a.offset().top+a.outerHeight()-b.offset().top+b.scrollTop()-b.height()))}};
f.prototype.handleKeyDown=function(a){var c=d(this.selectElement),b=c.data("selectBox-control"),e=b.data("selectBox-options"),c=c.data("selectBox-settings"),g=0,f=0;if(!b.hasClass("selectBox-disabled"))switch(a.keyCode){case 8:a.preventDefault();this.typeSearch="";break;case 9:case 27:this.hideMenus();this.removeHover();break;case 13:b.hasClass("selectBox-menuShowing")?(this.selectOption(e.find("LI.selectBox-hover:first"),a),b.hasClass("selectBox-dropdown")&&this.hideMenus()):this.showMenu();break;
case 38:case 37:a.preventDefault();if(b.hasClass("selectBox-menuShowing")){b=e.find(".selectBox-hover").prev("LI");g=e.find("LI:not(.selectBox-optgroup)").length;for(f=0;(0===b.length||b.hasClass("selectBox-disabled")||b.hasClass("selectBox-optgroup"))&&!(b=b.prev("LI"),0===b.length&&(b=c.loopOptions?e.find("LI:last"):e.find("LI:first")),++f>=g););this.addHover(b);this.selectOption(b,a);this.keepOptionInView(b)}else this.showMenu();break;case 40:case 39:if(a.preventDefault(),b.hasClass("selectBox-menuShowing")){b=
e.find(".selectBox-hover").next("LI");g=e.find("LI:not(.selectBox-optgroup)").length;for(f=0;(0===b.length||b.hasClass("selectBox-disabled")||b.hasClass("selectBox-optgroup"))&&!(b=b.next("LI"),0===b.length&&(b=c.loopOptions?e.find("LI:first"):e.find("LI:last")),++f>=g););this.addHover(b);this.selectOption(b,a);this.keepOptionInView(b)}else this.showMenu()}};f.prototype.handleKeyPress=function(a){var c=d(this.selectElement).data("selectBox-control"),b=c.data("selectBox-options"),e=this;if(!c.hasClass("selectBox-disabled"))switch(a.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;
default:c.hasClass("selectBox-menuShowing")||this.showMenu(),a.preventDefault(),clearTimeout(this.typeTimer),this.typeSearch+=String.fromCharCode(a.charCode||a.keyCode),b.find("A").each(function(){if(d(this).text().substr(0,e.typeSearch.length).toLowerCase()===e.typeSearch.toLowerCase())return e.addHover(d(this).parent()),e.selectOption(d(this).parent(),a),e.keepOptionInView(d(this).parent()),!1}),this.typeTimer=setTimeout(function(){e.typeSearch=""},1E3)}};f.prototype.enable=function(){var a=d(this.selectElement);
a.prop("disabled",!1);(a=a.data("selectBox-control"))&&a.removeClass("selectBox-disabled")};f.prototype.disable=function(){var a=d(this.selectElement);a.prop("disabled",!0);(a=a.data("selectBox-control"))&&a.addClass("selectBox-disabled")};f.prototype.setValue=function(a){var c=d(this.selectElement);c.val(a);a=c.val();null===a&&(a=c.children().first().val(),c.val(a));var b=c.data("selectBox-control");if(b){var e=c.data("selectBox-settings"),b=b.data("selectBox-options");this.setLabel();b.find(".selectBox-selected").removeClass("selectBox-selected");
b.find("A").each(function(){if("object"===typeof a)for(var b=0;b<a.length;b++)d(this).attr("rel")==a[b]&&d(this).parent().addClass("selectBox-selected");else d(this).attr("rel")==a&&d(this).parent().addClass("selectBox-selected")});e.change&&e.change.call(c)}};f.prototype.setOptions=function(a){var c=d(this.selectElement),b=c.data("selectBox-control");switch(typeof a){case "string":c.html(a);break;case "object":c.html("");for(var e in a)if(null!==a[e]){if("object"===typeof a[e]){var g=d('<optgroup label="'+
e+'" />'),f;for(f in a[e])g.append('<option value="'+f+'">'+a[e][f]+"</option>")}else g=d('<option value="'+e+'">'+a[e]+"</option>");c.append(g)}}b&&this.refresh()};f.prototype.disableSelection=function(a){d(a).css("MozUserSelect","none").bind("selectstart",function(a){a.preventDefault()})};f.prototype.generateOptions=function(a,c){var b=d("<li />"),e=d("<a />");b.addClass(a.attr("class"));b.data(a.data());e.attr("rel",a.val()).text(a.text());b.append(e);a.attr("disabled")&&b.addClass("selectBox-disabled");
a.attr("selected")&&b.addClass("selectBox-selected");c.append(b)};d.extend(d.fn,{selectBox:function(a,c){var b;switch(a){case "control":return d(this).data("selectBox-control");case "settings":if(!c)return d(this).data("selectBox-settings");d(this).each(function(){d(this).data("selectBox-settings",d.extend(!0,d(this).data("selectBox-settings"),c))});break;case "options":if(void 0===c)return d(this).data("selectBox-control").data("selectBox-options");d(this).each(function(){(b=d(this).data("selectBox"))&&
b.setOptions(c)});break;case "value":if(void 0===c)return d(this).val();d(this).each(function(){(b=d(this).data("selectBox"))&&b.setValue(c)});break;case "refresh":d(this).each(function(){(b=d(this).data("selectBox"))&&b.refresh()});break;case "enable":d(this).each(function(){(b=d(this).data("selectBox"))&&b.enable(this)});break;case "disable":d(this).each(function(){(b=d(this).data("selectBox"))&&b.disable()});break;case "destroy":d(this).each(function(){if(b=d(this).data("selectBox"))b.destroy(),
d(this).data("selectBox",null)});break;case "instance":return d(this).data("selectBox");default:d(this).each(function(b,c){d(c).data("selectBox")||d(c).data("selectBox",new f(c,a))})}return d(this)}})})(jQuery);